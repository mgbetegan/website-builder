<!-- ğŸ‘ï¸ CENTER PANEL - Live Preview -->

<div class="center-panel">
  <!-- PREVIEW HEADER -->
  <div class="preview-header">
    <h3>AperÃ§u</h3>

    <div class="preview-mode-toggle">
      <button
        class="mode-btn"
        [class.active]="previewMode === 'desktop'"
        (click)="switchPreviewMode('desktop')">
        ğŸ–¥ï¸ Desktop
      </button>
      <button
        class="mode-btn"
        [class.active]="previewMode === 'mobile'"
        (click)="switchPreviewMode('mobile')">
        ğŸ“± Mobile
      </button>
    </div>
  </div>

  <!-- PREVIEW VIEWPORT -->
  <div class="preview-container">
    <div class="viewport" [ngClass]="viewportClass">
      <!-- Loading State -->
      <div class="preview-loading" *ngIf="isRendering">
        <div class="spinner"></div>
        <p>Rendu en cours...</p>
      </div>

      <!-- Preview Content -->
      <div class="preview-content"
           *ngIf="!isRendering && mergedSite"
           cdkDropList
           id="preview-drop-list"
           [cdkDropListData]="mergedSite.structure"
           [cdkDropListConnectedTo]="['block-library-list']"
           (cdkDropListDropped)="onBlockDrop($event)">
        <div class="site-preview" [style.--primary]="mergedSite.theme.colors.primary"
                                    [style.--secondary]="mergedSite.theme.colors.secondary"
                                    [style.--text]="mergedSite.theme.colors.text"
                                    [style.--background]="mergedSite.theme.colors.background"
                                    [style.--font-heading]="mergedSite.theme.fonts.heading"
                                    [style.--font-body]="mergedSite.theme.fonts.body">
          <!-- Render each block using BlockRenderer -->
          <div *ngFor="let block of mergedSite.structure; let i = index"
               class="block-wrapper"
               [class.selected]="selectedBlockId === block.id"
               cdkDrag
               [cdkDragData]="block">
            <div class="block-controls">
              <div class="drag-handle" cdkDragHandle title="Glisser pour rÃ©organiser">
                <span class="drag-icon">â‹®â‹®</span>
              </div>
              <button class="btn-edit-block"
                      (click)="selectBlock(block)"
                      title="Ã‰diter ce bloc">
                âœï¸
              </button>
              <button class="btn-delete-block"
                      (click)="deleteBlock(i)"
                      title="Supprimer ce bloc">
                ğŸ—‘ï¸
              </button>
            </div>
            <app-block-renderer
              [block]="block"
              [theme]="mergedSite.theme">
            </app-block-renderer>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="preview-empty"
           *ngIf="!isRendering && !mergedSite"
           cdkDropList
           id="empty-drop-list"
           [cdkDropListConnectedTo]="['block-library-list']"
           (cdkDropListDropped)="onBlockDrop($event)">
        <div class="empty-icon">ğŸ“„</div>
        <p>Aucun contenu Ã  afficher</p>
        <small>Glissez-dÃ©posez des blocs ici pour commencer</small>
      </div>
    </div>
  </div>
</div>
