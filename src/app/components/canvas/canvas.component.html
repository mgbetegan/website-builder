<div class="canvas-container"
     (click)="deselectAll()"
     (drop)="onCanvasDrop($event)"
     (dragover)="onCanvasDragOver($event)">

  <div class="canvas-info">
    <p>Glissez des composants ici pour commencer</p>
  </div>

  @for (element of elements; track element.id) {
    <div [ngClass]="['builder-element', 'element-' + element.type, isSelected(element.id) ? 'selected' : '']"
         [ngStyle]="element.styles"
         [id]="element.id"
         cdkDrag
         [cdkDragFreeDragPosition]="{x: 0, y: 0}"
         (cdkDragEnded)="onDragEnded($event, element)"
         (click)="selectElement(element, $event)">

      @switch (element.type) {
        @case ('text') {
          <div class="text-content">{{ element.content }}</div>
        }
        @case ('button') {
          <button class="button-content" type="button">{{ element.content }}</button>
        }
        @case ('image') {
          <img [src]="element.content" alt="Image" class="image-content" />
        }
        @case ('container') {
          <div class="container-content">
            {{ element.children && element.children.length > 0 ? '' : 'Container vide' }}
          </div>
        }
        @case ('form') {
          <div class="form-content">
            {{ element.children && element.children.length > 0 ? '' : 'Formulaire vide - Ajoutez des champs' }}
          </div>
        }
        @case ('input') {
          <input class="input-content"
                 [type]="element.formAttributes?.inputType || 'text'"
                 [placeholder]="element.formAttributes?.placeholder || ''"
                 [disabled]="true" />
        }
        @case ('textarea') {
          <textarea class="textarea-content"
                    [placeholder]="element.formAttributes?.placeholder || ''"
                    [rows]="element.formAttributes?.rows || 4"
                    [disabled]="true"></textarea>
        }
        @case ('select') {
          <select class="select-content" [disabled]="true">
            @if (element.formAttributes?.options) {
              @for (option of element.formAttributes.options; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            }
          </select>
        }
        @case ('checkbox') {
          <label class="checkbox-content">
            <input type="checkbox"
                   [checked]="element.formAttributes?.checked || false"
                   [disabled]="true" />
            <span>{{ element.content }}</span>
          </label>
        }
        @case ('radio') {
          <div class="radio-content">
            @if (element.formAttributes?.options) {
              @for (option of element.formAttributes.options; track option.value) {
                <label>
                  <input type="radio"
                         [name]="element.formAttributes?.name || 'radio'"
                         [value]="option.value"
                         [disabled]="true" />
                  <span>{{ option.label }}</span>
                </label>
              }
            }
          </div>
        }
        @case ('label') {
          <label class="label-content">{{ element.content }}</label>
        }
      }

      @if (isSelected(element.id)) {
        <div class="selection-handles">
          <div class="handle top-left"></div>
          <div class="handle top-right"></div>
          <div class="handle bottom-left"></div>
          <div class="handle bottom-right"></div>
        </div>
      }
    </div>
  }
</div>
